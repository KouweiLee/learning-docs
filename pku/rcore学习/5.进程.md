# 5.进程

核心目标：让开发者能够控制程序的运行。相比于之前的任务，进程增加了动态变化的执行特点。

## 进程的基本概念

### waitpid系统调用

当一个进程通过 `exit` 系统调用退出之后，它所占用的资源并不能够立即全部回收，称为僵尸进程。之后，由该进程的父进程通过一个名为 `waitpid` 的系统调用来收集该进程的返回状态并回收掉它所占据的全部资源，这样这个进程才被彻底销毁。

如果父进程先于子进程结束，那么子进程的父进程会变为用户初始进程。

## 进程管理的核心数据结构

内核栈、进程标识符都采用了RAII思想，当被drop时，所占用的资源会被回收。

当结构体中部分字段初始化之后是不会改变的，而部分字段是可以改变的时，可以改变的字段可以用RefCell修饰上，实现内部可变性。

维护父子进程关系时，用到了大量的引用计数`Arc/Weak`

多了一个CPU处理器管理结构Processor，描述CPU的执行状态。增加idle的原因是，为了让调度机制对于换出进程的Trap执行流是不可见的。

### 进程管理的实现

首先创建第一个用户态进程`initproc`。
